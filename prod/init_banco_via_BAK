# Inicializa o banco de dos pelo arquivo .bak em sql_atualizado
# desnecess√°rio rodar init_api_embeddings.py e init_embeddings.py

import pyodbc

DRIVER_NAME = 'ODBC Driver 17 for SQL Server'
SERVER_NAME = '.'
CONNECTION_STRING = (
    f'DRIVER={{{DRIVER_NAME}}};'
    f'SERVER={SERVER_NAME};'
    f'DATABASE=master;'  # Conecta ao master para criar/restaurar
    'Trusted_Connection=yes;'
)

conexao = pyodbc.connect(CONNECTION_STRING, autocommit=True)
cursor = conexao.cursor()

backup_path = r'sql_atualizado/ic.bak'

# Restaura o banco
restore_query = f"""
RESTORE DATABASE ic 
FROM DISK = '{backup_path}'
WITH REPLACE
"""

cursor.execute(restore_query)
print("Banco de dados restaurado com sucesso!")

cursor.close()
conexao.close()
